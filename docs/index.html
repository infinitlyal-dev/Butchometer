<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BUTCHOMETER</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Serif:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --orange: #c45a20;
      --orange-dim: #8a3d15;
      --steel-darkest: #0d0c0b;
      --steel-dark: #151413;
      --steel-mid: #1e1d1b;
      --steel-light: #2a2826;
      --steel-lighter: #3a3735;
      --text-primary: #d4d0c8;
      --text-dim: #7a7570;
      --text-muted: #4a4540;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
    html, body { height: 100%; overflow-x: hidden; }
    
    body { 
      font-family: 'IBM Plex Serif', Georgia, serif;
      background: var(--steel-darkest);
      min-height: 100vh;
      color: var(--text-primary);
      line-height: 1.6;
    }

    .mono { font-family: 'IBM Plex Mono', monospace; }

    /* Noise texture overlay */
    .texture {
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
    }

    /* Title */
    .title {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 600;
      letter-spacing: 0.15em;
      color: var(--orange);
    }

    /* Steel plate button */
    .btn {
      background: linear-gradient(180deg, var(--steel-light) 0%, var(--steel-mid) 100%);
      border: 1px solid var(--steel-lighter);
      box-shadow: 
        0 2px 8px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(255,255,255,0.03);
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      cursor: pointer;
    }
    .btn:hover {
      box-shadow: 
        0 2px 12px rgba(0,0,0,0.5),
        inset 0 1px 0 rgba(255,255,255,0.05);
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }

    .btn-primary {
      border-color: var(--orange-dim);
      box-shadow: 
        0 2px 8px rgba(0,0,0,0.4),
        0 0 0 1px var(--orange-dim),
        inset 0 1px 0 rgba(255,255,255,0.03);
    }
    .btn-primary:hover {
      box-shadow: 
        0 2px 16px rgba(196,90,32,0.15),
        0 0 0 1px var(--orange),
        inset 0 1px 0 rgba(255,255,255,0.05);
    }

    /* Card */
    .card {
      background: var(--steel-mid);
      border: 1px solid var(--steel-lighter);
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    /* Input */
    .input {
      background: var(--steel-dark);
      border: 1px solid var(--steel-lighter);
      color: var(--text-primary);
      transition: border-color 0.15s ease;
    }
    .input:focus {
      outline: none;
      border-color: var(--orange-dim);
    }
    .input::placeholder { color: var(--text-muted); }

    /* Answer button */
    .answer {
      background: var(--steel-mid);
      border: 1px solid var(--steel-lighter);
      transition: border-color 0.15s ease, background 0.15s ease;
      cursor: pointer;
    }
    .answer:hover {
      border-color: var(--steel-lighter);
      background: var(--steel-light);
    }
    .answer:active {
      background: var(--steel-mid);
    }

    /* Progress bar */
    .progress-track {
      background: var(--steel-dark);
      border: 1px solid var(--steel-lighter);
    }
    .progress-fill {
      background: linear-gradient(90deg, var(--orange-dim), var(--orange));
      transition: width 0.4s ease;
    }

    /* Gauge/meter */
    .gauge {
      background: conic-gradient(
        from 180deg,
        var(--steel-lighter) 0deg,
        var(--steel-mid) 60deg,
        var(--steel-light) 120deg,
        var(--steel-mid) 180deg,
        var(--steel-lighter) 240deg,
        var(--steel-mid) 300deg,
        var(--steel-lighter) 360deg
      );
      box-shadow: 
        0 0 0 4px var(--steel-dark),
        0 0 0 5px var(--steel-lighter),
        inset 0 0 40px rgba(0,0,0,0.5);
    }
    .gauge-spin {
      animation: gaugeSpin 3s cubic-bezier(0.2, 0.9, 0.3, 1) forwards;
    }
    @keyframes gaugeSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(1440deg); }
    }

    /* Animations - subtle only */
    .fade-in { animation: fadeIn 0.3s ease forwards; }
    .slide-in { animation: slideIn 0.25s ease forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    /* Plaque for leaderboard */
    .plaque {
      background: linear-gradient(180deg, var(--steel-light) 0%, var(--steel-mid) 100%);
      border: 1px solid var(--steel-lighter);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.03);
    }

    /* Score display */
    .score-display {
      color: var(--orange);
      text-shadow: 0 0 20px rgba(196,90,32,0.3);
    }
  </style>
</head>
<body>
  <div class="texture"></div>
  <div id="app" class="relative z-10 min-h-screen"></div>

  <script>
    // ========== SOUNDS - Industrial, subtle ==========
    const sounds = {
      click: new Howl({ src: ['https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3'], volume: 0.15 }),
      thud: new Howl({ src: ['https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3'], volume: 0.2 }),
      heavy: new Howl({ src: ['https://assets.mixkit.co/active_storage/sfx/2573/2573-preview.mp3'], volume: 0.25 }),
      lock: new Howl({ src: ['https://assets.mixkit.co/active_storage/sfx/2577/2577-preview.mp3'], volume: 0.2 })
    };
    function playSound(name) { if (sounds[name]) sounds[name].play(); }

    // ========== QUESTIONS ==========
    const questions = {
      mild: [
        { id: 'm1', setup: "It's 6:47 AM. You're standing in the kitchen in your underwear, staring at an empty coffee bag. There's instant in the back of the cupboard. It's been there since the previous tenant.", answers: [
          { text: "You drive to the nearest café in your pajama pants because you have standards and those standards include not drinking something that dissolves. Instant coffee is for people who've given up on joy.", points: 1 },
          { text: "You make the instant because caffeine is a chemical and chemicals don't care about your feelings. It tastes like regret but regret is still technically a flavor.", points: 2 },
          { text: "You eat the crystals dry, straight from the jar, chased with tap water. Your ancestors crossed frozen tundras without espresso machines. This is efficiency, not desperation.", points: 3 }
        ]},
        { id: 'm2', setup: "There's a spider on the wall. Medium-sized. It hasn't moved in three minutes. You've been watching it like it owes you an explanation for being there.", answers: [
          { text: "You get a glass and a postcard, trap it with the care of a bomb disposal unit, and release it outside while whispering an apology because all life has value, even life with eight legs.", points: 1 },
          { text: "You smack it with whatever's nearby because you didn't invite it, it didn't pay to be here, and cohabitation requires consent. The wall wipes clean. Circle of life.", points: 2 },
          { text: "You leave it alone. That spider is now on pest control. It works for you. You've just hired someone without doing a single interview, and it's already more useful than most employees.", points: 3 }
        ]},
        { id: 'm3', setup: "You've bought flat-pack furniture. The box says 'easy assembly.' Inside: 47 wooden pieces, an Allen key the size of your thumb, and instructions drawn by someone who hates you personally.", answers: [
          { text: "You lay every piece out in order, match them to the diagram, and follow each step exactly because the Swedes have been building furniture longer than your country has existed. Trust the process.", points: 1 },
          { text: "You look at the pictures, ignore the words, and figure it out as you go because furniture is just shapes that fit together. If there are extra screws at the end, that's just bonus hardware.", points: 2 },
          { text: "Instructions are a suggestion for people who lack spatial intuition. You build by instinct. If it wobbles, that's not poor construction—that's character. Furniture should feel alive.", points: 3 }
        ]},
        { id: 'm4', setup: "There's a container in the back of the fridge. You don't remember putting it there. The lid is bulging with ambition. It could be chili. It could be a cry for help.", answers: [
          { text: "You throw it away unopened, container and all, because some doors shouldn't be opened. You're not a scientist. You're not equipped for what might be growing in there.", points: 1 },
          { text: "You crack it open and give it a sniff because noses exist for exactly this reason. If it smells like food, it's food. If it smells like a question, it's trash.", points: 2 },
          { text: "You eat it without investigation. Expiration dates are written by lawyers, not chefs. Your immune system didn't become this powerful by being protected from aged leftovers.", points: 3 }
        ]},
        { id: 'm5', setup: "The check engine light came on five days ago. The car runs fine. The light just sits there, glowing, like a passive-aggressive coworker who won't tell you what you did wrong.", answers: [
          { text: "You take it to a mechanic immediately because that light is a warning from engineers who know things you don't. Ignoring warnings is how main characters die in the first act.", points: 1 },
          { text: "You buy a code reader, check what it says, and make a judgment call. Half the time it's the gas cap. The other half, it's something you can worry about next paycheck.", points: 2 },
          { text: "You put electrical tape over it. Problem solved. The light is a symptom, not the disease. Cars ran fine before dashboards had opinions, and yours will too.", points: 3 }
        ]},
        { id: 'm6', setup: "It's raining. Steady, not heavy. Your car is forty feet away. No umbrella. Your jacket hood is decorative at best—designed by someone who's never met weather.", answers: [
          { text: "You wait at the door and watch the radar because getting wet is step one of getting sick, and getting sick is step one of canceling plans. Patience is just future comfort.", points: 1 },
          { text: "You pull the hood up, accept it won't help, and jog to the car because you're not sugar and you're not made of paper. Damp dries. Adults understand this.", points: 2 },
          { text: "You walk at your normal pace because running from rain is admitting it has power over you. Water falls. You move. The two events are not related.", points: 3 }
        ]},
        { id: 'm7', setup: "The jar won't open. You've tried twice. Your grip keeps slipping. Someone is watching from across the room. Your entire identity now depends on pickles.", answers: [
          { text: "You run hot water over the lid because metal expands when heated and physics doesn't care about pride. Technique beats strength. That's what separates us from gorillas.", points: 1 },
          { text: "You wrap it in a towel, use your whole body, and give it one genuine effort because sometimes things just need commitment. If it fails, you hand it off. No shame in teamwork.", points: 2 },
          { text: "You break the jar into a bowl and fish out what you need. You wanted what's inside, not a relationship with glass. Jars are packaging. Packaging is temporary.", points: 3 }
        ]},
        { id: 'm8', setup: "Someone touched the thermostat. The house is now 74 degrees. You can feel your electricity bill in real time. Sweat is forming. This is not a temperature—it's a betrayal.", answers: [
          { text: "You call a household meeting to establish clear thermostat boundaries because adults communicate, and communication prevents the kind of resentment that ends leases.", points: 1 },
          { text: "You change it back without comment. If they change it again, you change it again. This is a war of attrition, not a conversation. The patient one wins.", points: 2 },
          { text: "You remove the thermostat cover and hide it somewhere they'll never look. Comfort is earned, not dialed. If they're cold, there are blankets. Adaptation is growth.", points: 3 }
        ]}
      ],
      medium: [
        { id: 'd1', setup: "You're at a bar. The bartender's waiting. Behind you, someone just ordered a drink with eight ingredients and a smoke bubble. Everyone heard it. Everyone judged.", answers: [
          { text: "You order what you actually want, foam and all, because drink preferences don't define character and anyone who thinks otherwise peaked in a fraternity.", points: 1 },
          { text: "You say 'whiskey, neat' because it's efficient, it's honest, and it doesn't require the bartender to become a chemist. You tip well. You move on.", points: 2 },
          { text: "You point at the top shelf without looking and say 'that one, straight.' You don't ask what it costs. You don't ask what it is. Questions are for people with doubt.", points: 3 }
        ]},
        { id: 'd2', setup: "There's a machine at the gym you've never used. It has cables, pulleys, and a diagram that looks like it was designed to confuse NATO. Someone is waiting behind you.", answers: [
          { text: "You ask a trainer because that's what they're paid for and learning correctly once is faster than learning wrong three times. Ego doesn't build muscle. Form does.", points: 1 },
          { text: "You study the diagram, pick a low weight, and figure it out through trial and error because that's how humans have learned things since before trainers existed.", points: 2 },
          { text: "You sit down and start pulling whatever moves. If something's working, you'll feel it. Machines are just weighted furniture. Your body knows what it needs.", points: 3 }
        ]},
        { id: 'd3', setup: "You're lost. The GPS keeps saying 'recalculating' in a tone that suggests disappointment. Your passenger mentions, gently, that you could ask someone for directions.", answers: [
          { text: "You pull over and ask a local because humans have navigated each other home for thousands of years and satellites have existed for like forty. Trust the original system.", points: 1 },
          { text: "You keep driving with confidence because all roads lead somewhere, and eventually you'll recognize something. Getting lost is just aggressive exploration.", points: 2 },
          { text: "You turn off the GPS entirely. It's confused, not you. You know exactly where you are: in a car, moving forward. Destination is a mindset, not a pin.", points: 3 }
        ]},
        { id: 'd4', setup: "Someone offers a handshake and squeezes. Hard. Harder than a greeting requires. They're looking into your eyes like they're trying to read your tax returns.", answers: [
          { text: "You match their pressure briefly and release because you're confident enough not to turn every hello into a referendum on worth. Secure people don't grip-test.", points: 1 },
          { text: "You squeeze back proportionally—firm but not aggressive—because you're not a pushover but you're also not going to injure someone over a greeting.", points: 2 },
          { text: "You don't let go. You have nowhere to be. You cleared your afternoon. They started this, and now you both live here. In this handshake. Permanently.", points: 3 }
        ]},
        { id: 'd5', setup: "Someone orders food 'extra spicy' and slides it toward you with a smile. This isn't generosity. This is a trap wearing hospitality's clothing. Your mouth is a civilian.", answers: [
          { text: "You decline because you know your limits and performing pain for someone else's entertainment isn't dignified. There's no prize for suffering. Just suffering.", points: 1 },
          { text: "You take a bite, handle what you can, drink water if needed, and maintain composure because trying things is how you grow, even if growing burns.", points: 2 },
          { text: "You eat the whole thing without flinching, maintain eye contact, and ask if they have anything with actual flavor. You will cry later. Alone. In a cold shower. Like a champion.", points: 3 }
        ]},
        { id: 'd6', setup: "Someone cuts directly in front of you in line. No apology. No acknowledgment. They just... exist there now, like they invented the concept of standing and you're the tourist.", answers: [
          { text: "You let it go because confrontation raises cortisol and cortisol causes wrinkles. They'll answer for it eventually. The universe keeps receipts.", points: 1 },
          { text: "You tap their shoulder, gesture at the line behind you, and let the silence deliver your point. No yelling needed. Just geography and eye contact.", points: 2 },
          { text: "You step in front of them, turn around, and say 'Oh sorry, is there a line?' with the energy of someone who's been rehearsing this moment since childhood.", points: 3 }
        ]},
        { id: 'd7', setup: "You have a splinter. Deep. You can see it under the skin, smug, like it's won something. Someone offers tweezers and a look that says 'you poor thing.'", answers: [
          { text: "You sterilize the tweezers, work in good light, and extract it carefully because infections exist, hospitals are expensive, and wood belongs in trees, not in you.", points: 1 },
          { text: "You dig it out with whatever's handy—a knife, a needle, determination—because it's just wood and you're mostly water. You outrank it on the food chain.", points: 2 },
          { text: "You leave it. Your body will push it out when it's ready, or absorb it and make you stronger. That's basically a wood vitamin. That's free construction material.", points: 3 }
        ]}
      ],
      extreme: [
        { id: 'e1', setup: "You're in the woods. There's a bear. Not close, but close enough to have an opinion about you. It's looking at you the way you look at a menu you haven't decided on yet.", answers: [
          { text: "You back away slowly, make yourself small, and avoid eye contact because bears are 600 pounds of muscle with no mortgage. They have nothing to lose.", points: 1 },
          { text: "You make yourself big, make noise, and convince the bear you're more trouble than you're worth because nature respects a cost-benefit analysis.", points: 2 },
          { text: "You maintain eye contact and walk toward it. There's room for one apex predator in this forest, and you didn't drive three hours to come in second.", points: 3 }
        ]},
        { id: 'e2', setup: "Power's out. Storm's screaming. The candles have maybe an hour left. Someone says 'we should have prepared for this' and they're not wrong but also not helpful.", answers: [
          { text: "You bundle up, ration the light, and wait for morning because the power company exists for this reason. Survival isn't about proving things. It's about outlasting them.", points: 1 },
          { text: "You light the fireplace, open canned goods, and ride it out because you've seen enough survival shows to fake competence. Heat, food, patience. In that order.", points: 2 },
          { text: "You walk outside to meet the storm face to face. Electricity was making you soft anyway. Your great-grandparents lived by firelight and they were terrifying people.", points: 3 }
        ]},
        { id: 'e3', setup: "You've had a toothache for five days. Someone suggests a dentist. Dentists are people who went to school specifically to disappoint you while you can't close your mouth.", answers: [
          { text: "You make the appointment because tooth infections can spread to your brain and dying of stubbornness is a legacy nobody wants. Modern dentistry has drugs. Good ones.", points: 1 },
          { text: "You try clove oil, ibuprofen, and hoping because sometimes teeth just need to work through their feelings. Give it a few more days. Bodies heal.", points: 2 },
          { text: "You ignore it completely. Teeth are bones and bones heal themselves. And if this one doesn't, you have backups. That's called redundancy. That's called intelligent design.", points: 3 }
        ]},
        { id: 'e4', setup: "Someone hands you meat from an animal you cannot identify. They're proud. They caught it. It's charred, on a stick, and it has a face you're trying not to make eye contact with.", answers: [
          { text: "You decline politely because mystery meat is how documentaries about food poisoning begin. You support their hunting. You do not support your intestines becoming a crime scene.", points: 1 },
          { text: "You ask what it is, get an answer that raises more questions than it answers, eat it anyway because refusing hospitality is rude, and trust that fire killed whatever needed killing.", points: 2 },
          { text: "You take a bite without asking. Protein is protein. Labels are for grocery stores. Your ancestors ate what they caught and they had immune systems like Greek gods.", points: 3 }
        ]},
        { id: 'e5', setup: "There's a cliff. There's water below. Everyone else jumped and survived. Probably. They're down there waving at you like you owe them something. The pressure is visible.", answers: [
          { text: "You climb back down the safe path because peer pressure is just pressure that happens to have friends. You don't owe anyone a hospital visit to prove you're fun.", points: 1 },
          { text: "You check the depth, take a breath, and jump feet-first because controlled risk is how you grow. You surface to applause. Nobody mentions you screamed.", points: 2 },
          { text: "You do a backflip. You've never done one before but your body has been saving it for a moment exactly like this. Destiny doesn't ask if you're ready.", points: 3 }
        ]},
        { id: 'e6', setup: "It's 3 AM. There's a sound downstairs. Not a normal sound. You don't own a pet. You don't own anything that makes that particular noise. The house disagrees.", answers: [
          { text: "You stay in the room, lock the door, and call someone because this is how people survive horror movies. You've watched enough of them to know the rules. The rules are 'stay put.'", points: 1 },
          { text: "You grab something heavy, turn on lights as you go, and investigate like someone who owns this house and pays the mortgage. It's probably the wind. You'd like to confirm that.", points: 2 },
          { text: "You go downstairs in complete darkness because whatever's down there is about to learn it picked the wrong house. You didn't choose violence, but you answer when it calls.", points: 3 }
        ]},
        { id: 'e7', setup: "Your car is making a new noise. Then there's smoke. Just a little. The dashboard lights up like it's having a panic attack. Several warning lights you didn't know existed are blinking.", answers: [
          { text: "You pull over immediately, turn it off, and call for help because cars are contained explosions on wheels and you didn't sign up to become a cautionary tale.", points: 1 },
          { text: "You pull over, pop the hood, and look for anything actively on fire. If nothing's burning, it's probably fine for now. You'll deal with it when you have time and money.", points: 2 },
          { text: "You keep driving. Cars complain. That's what they do. It'll either fix itself or explode, and either way, you're not handling this on the shoulder like some kind of pedestrian.", points: 3 }
        ]}
      ]
    };

    // ========== RESULT LINES ==========
    const resultLines = {
      low: [
        "You brought a backup phone charger to a barbecue.",
        "Somewhere, a scented candle just lit itself in your honor.",
        "You've apologized to a door after walking into it.",
        "Your idea of roughing it is a hotel without a spa.",
        "You've asked a waiter if the water is local.",
        "A firm handshake would destroy you.",
        "Even your anxiety has anxiety.",
        "You've googled 'is this rash serious' more than once today.",
        "You own emergency snacks for your emergency snacks.",
        "A stiff breeze would file a restraining order against you.",
        "You've rehearsed ordering coffee.",
        "Your comfort zone has a gift shop.",
        "You bring a jacket to places that already have heat.",
        "You read the terms and conditions.",
        "You've worried about whether a houseplant likes you.",
        "Even your sneezes are polite."
      ],
      mid: [
        "Competent but not memorable. Like beige, but useful.",
        "You'd survive a camping trip. Probably.",
        "Tough when it's convenient. Soft when it's not.",
        "You own a toolbox. You've opened it twice.",
        "You could change a tire. With YouTube. And time.",
        "You've built something from IKEA without crying. Once.",
        "Not soft. Not hard. Room temperature.",
        "You've fixed something with duct tape and called it done.",
        "You handle problems eventually.",
        "You've grilled meat successfully. It was adequate.",
        "You own boots. They're mostly clean.",
        "Functional. Dependable. Forgettable.",
        "You'd help someone move, but you'd complain the whole time.",
        "Somewhere between capable and just getting by.",
        "You've pushed through discomfort. Minor discomfort.",
        "You can parallel park. It takes four tries."
      ],
      high: [
        "You've fixed something by hitting it, and it worked.",
        "Your handshake has ended conversations.",
        "You've eaten something you couldn't identify and asked for seconds.",
        "Pain is just your body making suggestions.",
        "You've used a knife as a screwdriver more than once.",
        "Instructions are just opinions from strangers.",
        "You've intimidated furniture into staying assembled.",
        "Your backup plan is 'push harder.'",
        "Doctors are just people with opinions about your body.",
        "You've slept somewhere that wasn't designed for sleeping.",
        "Expiration dates are just corporations showing fear.",
        "You've called something 'fine' while it was visibly on fire.",
        "You've solved a problem by ignoring it until it left.",
        "Weather reports are just suggestions you don't take.",
        "You've answered 'does this hurt?' with 'not really' while bleeding.",
        "Preparation is for people who don't trust themselves."
      ]
    };

    // ========== GAME STATE ==========
    let state = {
      screen: 'home',
      mode: null,
      players: [],
      playerNames: [''],
      currentPlayerIndex: 0,
      currentQuestionIndex: 0,
      sessionQuestions: [],
      measuring: false,
      showResult: false
    };

    // ========== LOCAL STORAGE ==========
    const STORAGE_KEY = 'butchometer_recent';
    function getRecent() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
      catch { return []; }
    }
    function saveRecent(ids) {
      const recent = getRecent();
      const updated = [...new Set([...ids, ...recent])].slice(0, 40);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));
    }

    function pickQuestions() {
      const recent = getRecent();
      const shuffle = arr => [...arr].sort(() => Math.random() - 0.5);
      const filter = arr => arr.filter(q => !recent.includes(q.id));
      
      let mild = shuffle(filter(questions.mild));
      let medium = shuffle(filter(questions.medium));
      let extreme = shuffle(filter(questions.extreme));
      
      if (mild.length < 4) mild = shuffle(questions.mild);
      if (medium.length < 3) medium = shuffle(questions.medium);
      if (extreme.length < 3) extreme = shuffle(questions.extreme);
      
      const selected = [...mild.slice(0, 4), ...medium.slice(0, 3), ...extreme.slice(0, 3)];
      saveRecent(selected.map(q => q.id));
      return selected;
    }

    function getResultLine(score) {
      const bracket = score <= 10 ? 'low' : score <= 20 ? 'mid' : 'high';
      const lines = resultLines[bracket];
      return lines[Math.floor(Math.random() * lines.length)];
    }

    // ========== RENDER ==========
    function render() {
      document.getElementById('app').innerHTML = screens[state.screen]();
    }

    const screens = {
      home: () => `
        <div class="min-h-screen flex flex-col items-center justify-center p-6">
          <div class="text-center max-w-md">
            <h1 class="title text-4xl md:text-5xl mb-3">BUTCHOMETER</h1>
            <p class="text-sm text-[var(--text-dim)] mb-10">Ten questions. No mercy.</p>
            <div class="flex flex-col gap-3">
              <button onclick="selectMode('single'); playSound('click');" class="btn py-4 px-6 rounded">
                <span class="mono text-sm tracking-wide text-[var(--text-primary)]">SINGLE</span>
              </button>
              <button onclick="selectMode('multiplayer'); playSound('click');" class="btn py-4 px-6 rounded">
                <span class="mono text-sm tracking-wide text-[var(--text-primary)]">MULTIPLAYER</span>
              </button>
            </div>
          </div>
        </div>`,

      setup: () => `
        <div class="min-h-screen p-6">
          <div class="max-w-md mx-auto pt-8">
            <button onclick="goHome(); playSound('click');" class="mono text-xs text-[var(--text-dim)] hover:text-[var(--text-primary)] mb-8 block">← BACK</button>
            <h2 class="title text-xl mb-6">${state.mode === 'single' ? 'IDENTIFY YOURSELF' : 'NAME THE ACCUSED'}</h2>
            <div class="card rounded p-5 mb-6">
              ${state.playerNames.map((n, i) => `
                <div class="flex gap-3 mb-3">
                  <input type="text" value="${n}" oninput="updateName(${i}, this.value)" placeholder="Player ${i+1}" class="input flex-1 rounded px-4 py-3 mono text-sm" maxlength="12">
                  ${state.mode === 'multiplayer' && state.playerNames.length > 2 ? `
                    <button onclick="removePlayer(${i}); playSound('click');" class="text-[var(--text-dim)] hover:text-[var(--text-primary)] px-2 mono">×</button>
                  ` : ''}
                </div>
              `).join('')}
              ${state.mode === 'multiplayer' && state.playerNames.length < 6 ? `
                <button onclick="addPlayer(); playSound('click');" class="w-full border border-dashed border-[var(--steel-lighter)] text-[var(--text-dim)] py-3 rounded mono text-xs hover:border-[var(--text-dim)] transition-colors mt-2">
                  + ADD
                </button>
              ` : ''}
            </div>
            <button onclick="startGame(); playSound('thud');" class="btn btn-primary w-full py-4 rounded">
              <span class="mono text-sm tracking-wide text-[var(--text-primary)]">BEGIN</span>
            </button>
          </div>
        </div>`,

      quiz: () => {
        const q = state.sessionQuestions[state.currentQuestionIndex];
        const p = state.players[state.currentPlayerIndex];
        const progress = ((state.currentQuestionIndex) / 10) * 100;
        return `
        <div class="min-h-screen p-4 md:p-6">
          <div class="max-w-2xl mx-auto pt-4">
            <div class="flex justify-between items-center mb-4">
              <span class="mono text-xs text-[var(--text-dim)]">${p?.name || 'PLAYER'}</span>
              <span class="mono text-xs text-[var(--text-dim)]">${state.currentQuestionIndex + 1} / 10</span>
            </div>
            <div class="progress-track h-1 rounded-full mb-6">
              <div class="progress-fill h-full rounded-full" style="width: ${progress}%"></div>
            </div>
            <div class="card rounded p-5 mb-5 slide-in">
              <p class="text-base md:text-lg leading-relaxed">${q?.setup}</p>
            </div>
            <div class="space-y-2">
              ${q?.answers.map((a, i) => `
                <button onclick="answer(${a.points}); playSound('${a.points === 3 ? 'heavy' : a.points === 2 ? 'thud' : 'click'}');" class="answer w-full rounded p-4 text-left slide-in" style="animation-delay: ${i * 0.05}s">
                  <span class="text-sm md:text-base leading-relaxed text-[var(--text-primary)]">${a.text}</span>
                </button>
              `).join('')}
            </div>
          </div>
        </div>`;
      },

      results: () => {
        const p = state.players[state.currentPlayerIndex];
        const score = p?.score || 0;
        return `
        <div class="min-h-screen flex flex-col items-center justify-center p-6">
          <div class="text-center max-w-md">
            <p class="mono text-xs text-[var(--text-dim)] mb-6">${p?.name}</p>
            <div class="relative w-40 h-40 mx-auto mb-8">
              <div class="gauge w-full h-full rounded-full ${state.measuring ? 'gauge-spin' : ''}"></div>
              ${!state.measuring ? `
                <div class="absolute inset-0 flex items-center justify-center fade-in">
                  <span class="mono text-5xl score-display">${score}</span>
                </div>
              ` : ''}
            </div>
            ${state.showResult ? `
              <div class="fade-in">
                <p class="text-lg mb-8 leading-relaxed">${p?.resultLine}</p>
                <div class="flex flex-col gap-3">
                  ${state.mode === 'multiplayer' && state.currentPlayerIndex < state.players.length - 1 
                    ? `<button onclick="nextPlayer(); playSound('thud');" class="btn btn-primary py-4 px-6 rounded mono text-sm">NEXT</button>`
                    : state.mode === 'multiplayer' 
                    ? `<button onclick="showLeaderboard(); playSound('lock');" class="btn btn-primary py-4 px-6 rounded mono text-sm">RESULTS</button>`
                    : `<button onclick="goHome(); playSound('thud');" class="btn py-4 px-6 rounded mono text-sm">AGAIN</button>`}
                </div>
              </div>
            ` : `
              <p class="mono text-sm text-[var(--text-dim)]">MEASURING...</p>
            `}
          </div>
        </div>`;
      },

      leaderboard: () => {
        const sorted = [...state.players].sort((a, b) => b.score - a.score);
        return `
        <div class="min-h-screen p-6">
          <div class="max-w-md mx-auto pt-8">
            <h2 class="title text-xl mb-6 text-center">VERDICT</h2>
            <div class="space-y-2 mb-8">
              ${sorted.map((p, i) => `
                <div class="plaque rounded p-4 flex items-center gap-4 slide-in" style="animation-delay: ${i * 0.08}s">
                  <span class="mono text-xs text-[var(--text-muted)] w-6">${i + 1}.</span>
                  <div class="flex-1 overflow-hidden">
                    <p class="mono text-sm text-[var(--text-primary)]">${p.name}</p>
                    <p class="text-xs text-[var(--text-dim)] truncate mt-1">${p.resultLine}</p>
                  </div>
                  <span class="mono text-xl score-display">${p.score}</span>
                </div>
              `).join('')}
            </div>
            <button onclick="goHome(); playSound('thud');" class="btn w-full py-4 rounded mono text-sm">DONE</button>
          </div>
        </div>`;
      }
    };

    // ========== GAME FUNCTIONS ==========
    function selectMode(mode) {
      state.mode = mode;
      state.playerNames = mode === 'multiplayer' ? ['', ''] : [''];
      state.screen = 'setup';
      render();
    }

    function goHome() {
      state = { screen: 'home', mode: null, players: [], playerNames: [''], currentPlayerIndex: 0, currentQuestionIndex: 0, sessionQuestions: [], measuring: false, showResult: false };
      render();
    }

    function updateName(i, val) { state.playerNames[i] = val; }
    function addPlayer() { if (state.playerNames.length < 6) { state.playerNames.push(''); render(); } }
    function removePlayer(i) { if (state.playerNames.length > 2) { state.playerNames.splice(i, 1); render(); } }

    function startGame() {
      const names = state.playerNames;
      if (state.mode === 'multiplayer' && names.filter(n => n.trim()).length < 2) {
        return;
      }
      state.players = names.map((n, i) => ({ id: i, name: n.trim() || `Player ${i + 1}`, score: 0, answers: [], resultLine: '' }));
      state.currentPlayerIndex = 0;
      state.currentQuestionIndex = 0;
      state.sessionQuestions = pickQuestions();
      state.screen = 'quiz';
      render();
    }

    function answer(points) {
      state.players[state.currentPlayerIndex].score += points;

      if (state.currentQuestionIndex < 9) {
        state.currentQuestionIndex++;
        render();
      } else {
        state.players[state.currentPlayerIndex].resultLine = getResultLine(state.players[state.currentPlayerIndex].score);
        state.measuring = true;
        state.showResult = false;
        state.screen = 'results';
        render();
        
        setTimeout(() => {
          state.measuring = false;
          render();
          playSound('lock');
          setTimeout(() => {
            state.showResult = true;
            render();
          }, 400);
        }, 3000);
      }
    }

    function nextPlayer() {
      state.currentPlayerIndex++;
      state.currentQuestionIndex = 0;
      state.sessionQuestions = pickQuestions();
      state.measuring = false;
      state.showResult = false;
      state.screen = 'quiz';
      render();
    }

    function showLeaderboard() {
      state.screen = 'leaderboard';
      render();
    }

    render();
  </script>
</body>
</html>
