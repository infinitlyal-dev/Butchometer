<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BUTCHOMETER</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --orange: #d4621a;
      --orange-glow: #ff6b1a;
      --orange-hot: #ff8534;
      --orange-dim: #7a3a10;
      --ember: #ff4500;
      --black: #080706;
      --steel-darkest: #0c0b0a;
      --steel-dark: #131211;
      --steel-mid: #1a1918;
      --steel-light: #242220;
      --steel-lighter: #322f2c;
      --steel-edge: #433f3a;
      --steel-highlight: #5a5550;
      --text-primary: #c8c4bc;
      --text-dim: #6a665f;
      --text-muted: #3a3835;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
    html, body { height: 100%; overflow-x: hidden; }
    
    body { 
      font-family: 'IBM Plex Mono', monospace;
      background: var(--black);
      min-height: 100vh;
      color: var(--text-primary);
      line-height: 1.65;
    }

    /* ========== TEXTURE & ATMOSPHERE ========== */
    .texture {
      position: fixed;
      inset: 0;
      background: 
        repeating-linear-gradient(
          -45deg,
          transparent 0px,
          transparent 1px,
          rgba(255,255,255,0.012) 1px,
          rgba(255,255,255,0.012) 2px
        ),
        radial-gradient(ellipse at 50% 120%, rgba(212,98,26,0.08) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    .furnace-glow {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 300px;
      background: radial-gradient(ellipse at 50% 100%, rgba(212,98,26,0.12) 0%, rgba(255,69,0,0.04) 30%, transparent 70%);
      pointer-events: none;
      z-index: 0;
      animation: furnacePulse 4s ease-in-out infinite;
    }

    @keyframes furnacePulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* ========== EMBER PARTICLES ========== */
    .ember-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .ember {
      position: absolute;
      width: 3px;
      height: 3px;
      background: var(--ember);
      border-radius: 50%;
      opacity: 0;
      box-shadow: 0 0 6px 2px rgba(255,69,0,0.6), 0 0 12px 4px rgba(255,107,26,0.3);
      animation: emberFloat 8s ease-out infinite;
    }

    @keyframes emberFloat {
      0% {
        opacity: 0;
        transform: translateY(100vh) scale(0.5);
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 0.6;
      }
      100% {
        opacity: 0;
        transform: translateY(-20vh) translateX(var(--drift, 30px)) scale(0.2);
      }
    }

    /* ========== FORGED STEEL TITLE ========== */
    .forged-title {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      font-size: clamp(2.5rem, 10vw, 4rem);
      position: relative;
      display: inline-block;
      
      /* Steel base */
      background: linear-gradient(
        180deg,
        var(--steel-highlight) 0%,
        var(--steel-lighter) 25%,
        var(--steel-edge) 50%,
        var(--steel-lighter) 75%,
        var(--steel-highlight) 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      
      /* Steel texture overlay */
      text-shadow: 
        0 1px 0 rgba(255,255,255,0.1),
        0 -1px 0 rgba(0,0,0,0.5),
        0 0 30px rgba(212,98,26,0.3);
      
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.8));
    }

    .forged-title::before {
      content: 'BUTCHOMETER';
      position: absolute;
      left: 0;
      top: 0;
      background: linear-gradient(
        180deg,
        transparent 0%,
        rgba(255,107,26,0.4) 30%,
        rgba(255,69,0,0.6) 50%,
        rgba(255,107,26,0.4) 70%,
        transparent 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: heatGlow 3s ease-in-out infinite;
    }

    .forged-title::after {
      content: '';
      position: absolute;
      left: -10%;
      right: -10%;
      bottom: -8px;
      height: 4px;
      background: linear-gradient(90deg, transparent, var(--orange), var(--orange-hot), var(--orange), transparent);
      border-radius: 2px;
      box-shadow: 0 0 20px var(--orange), 0 0 40px rgba(255,69,0,0.5);
      animation: emberBar 2s ease-in-out infinite;
    }

    @keyframes heatGlow {
      0%, 100% { opacity: 0.6; filter: blur(0px); }
      50% { opacity: 1; filter: blur(1px); }
    }

    @keyframes emberBar {
      0%, 100% { opacity: 0.8; transform: scaleX(0.95); }
      50% { opacity: 1; transform: scaleX(1); }
    }

    /* Heat shimmer effect */
    .heat-shimmer {
      position: relative;
    }
    .heat-shimmer::before {
      content: '';
      position: absolute;
      inset: -20px;
      background: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.03;
      pointer-events: none;
      animation: shimmer 0.15s steps(3) infinite;
    }

    @keyframes shimmer {
      0% { transform: translate(0, 0); }
      33% { transform: translate(-1px, 1px); }
      66% { transform: translate(1px, -1px); }
      100% { transform: translate(0, 0); }
    }

    /* ========== BUTTONS ========== */
    .btn {
      position: relative;
      background: linear-gradient(180deg, var(--steel-light) 0%, var(--steel-mid) 40%, var(--steel-dark) 100%);
      border: 1px solid var(--steel-lighter);
      border-bottom: 3px solid var(--black);
      box-shadow: 
        0 4px 16px rgba(0,0,0,0.7),
        inset 0 1px 0 rgba(255,255,255,0.06),
        inset 0 -2px 4px rgba(0,0,0,0.2);
      transition: all 0.1s ease;
      cursor: pointer;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(255,255,255,0.05) 0%, transparent 50%);
      pointer-events: none;
    }

    .btn:hover {
      background: linear-gradient(180deg, var(--steel-lighter) 0%, var(--steel-light) 40%, var(--steel-mid) 100%);
      box-shadow: 
        0 4px 20px rgba(0,0,0,0.8),
        0 0 20px rgba(212,98,26,0.1),
        inset 0 1px 0 rgba(255,255,255,0.08);
    }

    .btn:active {
      transform: translateY(3px);
      border-bottom-width: 1px;
      box-shadow: 
        0 1px 4px rgba(0,0,0,0.6),
        inset 0 2px 6px rgba(0,0,0,0.4);
    }

    .btn-primary {
      border-color: var(--orange-dim);
      box-shadow: 
        0 4px 16px rgba(0,0,0,0.7),
        0 0 0 1px rgba(212,98,26,0.4),
        0 0 30px rgba(212,98,26,0.1),
        inset 0 1px 0 rgba(255,255,255,0.06);
    }

    .btn-primary:hover {
      box-shadow: 
        0 4px 24px rgba(212,98,26,0.3),
        0 0 0 1px rgba(212,98,26,0.6),
        0 0 40px rgba(212,98,26,0.2),
        inset 0 1px 0 rgba(255,255,255,0.08);
    }

    /* ========== CARDS & PANELS ========== */
    .card {
      position: relative;
      background: linear-gradient(180deg, var(--steel-mid) 0%, var(--steel-dark) 100%);
      border: 1px solid var(--steel-lighter);
      box-shadow: 
        0 8px 40px rgba(0,0,0,0.6),
        inset 0 1px 0 rgba(255,255,255,0.04),
        inset 0 -1px 0 rgba(0,0,0,0.3);
    }

    .card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: 
        repeating-linear-gradient(
          90deg,
          transparent 0px,
          transparent 2px,
          rgba(255,255,255,0.008) 2px,
          rgba(255,255,255,0.008) 4px
        );
      pointer-events: none;
      border-radius: inherit;
    }

    /* ========== INPUTS ========== */
    .input {
      background: var(--steel-darkest);
      border: 2px solid var(--steel-mid);
      border-top-color: var(--black);
      color: var(--text-primary);
      box-shadow: inset 0 3px 8px rgba(0,0,0,0.5);
      transition: all 0.2s ease;
    }

    .input:focus {
      outline: none;
      border-color: var(--orange-dim);
      box-shadow: 
        inset 0 3px 8px rgba(0,0,0,0.5),
        0 0 0 3px rgba(212,98,26,0.2),
        0 0 20px rgba(212,98,26,0.15);
    }

    .input::placeholder { color: var(--text-muted); }

    /* ========== ANSWER BUTTONS ========== */
    .answer {
      position: relative;
      background: linear-gradient(180deg, var(--steel-mid) 0%, var(--steel-dark) 100%);
      border: 1px solid var(--steel-lighter);
      border-left: 4px solid var(--steel-lighter);
      transition: all 0.15s ease;
      cursor: pointer;
      overflow: hidden;
    }

    .answer::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0;
      background: linear-gradient(90deg, rgba(212,98,26,0.15), transparent);
      transition: width 0.2s ease;
    }

    .answer:hover {
      background: linear-gradient(180deg, var(--steel-light) 0%, var(--steel-mid) 100%);
      transform: translateX(4px);
    }

    .answer:hover::before {
      width: 100px;
    }

    .answer:active {
      background: var(--steel-dark);
      transform: translateX(6px) scale(0.99);
    }

    .answer-label {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: var(--steel-darkest);
      border: 1px solid var(--steel-edge);
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.75rem;
      color: var(--text-dim);
      flex-shrink: 0;
      margin-right: 12px;
      transition: all 0.15s ease;
    }

    .answer:hover .answer-label {
      background: var(--steel-mid);
      border-color: var(--orange-dim);
      color: var(--orange);
    }

    /* ========== PROGRESS BAR ========== */
    .progress-track {
      background: var(--steel-darkest);
      border: 1px solid var(--steel-mid);
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.6);
      position: relative;
      overflow: hidden;
    }

    .progress-fill {
      background: linear-gradient(90deg, var(--orange-dim) 0%, var(--orange) 50%, var(--orange-hot) 100%);
      box-shadow: 0 0 12px rgba(212,98,26,0.5), 0 0 24px rgba(255,69,0,0.3);
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 20px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3));
      animation: progressShine 1.5s ease-in-out infinite;
    }

    @keyframes progressShine {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    /* ========== GAUGE ========== */
    .gauge {
      background: 
        conic-gradient(
          from 180deg,
          var(--steel-lighter) 0deg,
          var(--steel-mid) 45deg,
          var(--steel-dark) 90deg,
          var(--steel-mid) 135deg,
          var(--steel-lighter) 180deg,
          var(--steel-mid) 225deg,
          var(--steel-dark) 270deg,
          var(--steel-mid) 315deg,
          var(--steel-lighter) 360deg
        );
      box-shadow: 
        0 0 0 8px var(--steel-dark),
        0 0 0 10px var(--steel-lighter),
        0 0 0 14px var(--black),
        0 0 60px rgba(212,98,26,0.2),
        inset 0 0 80px rgba(0,0,0,0.8);
    }

    .gauge-spin {
      animation: gaugeSpin 2.5s cubic-bezier(0.15, 0.85, 0.25, 1) forwards;
    }

    @keyframes gaugeSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(1080deg); }
    }

    .score-display {
      color: var(--orange);
      text-shadow: 
        0 0 30px rgba(212,98,26,0.6),
        0 0 60px rgba(255,69,0,0.3),
        0 2px 4px rgba(0,0,0,0.8);
    }

    .score-reveal {
      animation: scoreReveal 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes scoreReveal {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    /* ========== ANIMATIONS ========== */
    .fade-in { animation: fadeIn 0.35s ease-out forwards; }
    .slide-in { animation: slideIn 0.3s ease-out forwards; }
    .heavy-in { animation: heavyIn 0.5s cubic-bezier(0.2, 0, 0.3, 1) forwards; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes heavyIn { from { opacity: 0; transform: translateY(24px) scale(0.97); } to { opacity: 1; transform: translateY(0) scale(1); } }

    .screen-enter { animation: screenEnter 0.4s ease-out forwards; }
    @keyframes screenEnter { 
      from { opacity: 0; } 
      to { opacity: 1; } 
    }

    /* ========== LAVA SPLASH PARTICLES ========== */
    .lava-splash {
      position: fixed;
      pointer-events: none;
      z-index: 1000;
    }

    .lava-particle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, var(--orange-hot), var(--orange));
      border-radius: 50%;
      box-shadow: 0 0 10px var(--orange), 0 0 20px rgba(255,69,0,0.5);
      animation: lavaSplash 0.6s ease-out forwards;
    }

    @keyframes lavaSplash {
      0% {
        opacity: 1;
        transform: translate(0, 0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(var(--tx), var(--ty)) scale(0);
      }
    }

    /* ========== MUTE TOGGLE ========== */
    .mute-toggle {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 100;
      width: 40px;
      height: 40px;
      background: var(--steel-dark);
      border: 1px solid var(--steel-lighter);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
      color: var(--text-dim);
    }

    .mute-toggle:hover {
      background: var(--steel-mid);
      color: var(--text-primary);
    }

    .mute-toggle.muted {
      color: var(--orange-dim);
    }

    /* ========== TOAST ========== */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--steel-mid);
      border: 1px solid var(--orange-dim);
      padding: 12px 24px;
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.875rem;
      z-index: 1000;
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 8px 32px rgba(0,0,0,0.6), 0 0 20px rgba(212,98,26,0.2);
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* ========== SHARE BUTTON ========== */
    .share-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .share-btn svg {
      width: 18px;
      height: 18px;
    }

    /* ========== PLAQUE ========== */
    .plaque {
      background: linear-gradient(180deg, var(--steel-light) 0%, var(--steel-mid) 50%, var(--steel-dark) 100%);
      border: 1px solid var(--steel-lighter);
      box-shadow: 
        inset 0 1px 0 rgba(255,255,255,0.05),
        0 6px 20px rgba(0,0,0,0.5);
    }

    /* ========== REDUCED MOTION ========== */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .ember, .furnace-glow, .heat-shimmer::before {
        display: none !important;
      }
    }

    /* ========== QUESTION NUMBER ========== */
    .question-number {
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      padding: 4px 10px;
      background: var(--steel-darkest);
      border: 1px solid var(--steel-mid);
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="texture"></div>
  <div class="furnace-glow"></div>
  <div class="ember-container" id="embers"></div>
  <button class="mute-toggle" id="muteToggle" onclick="toggleMute()" aria-label="Toggle sound">
    <svg id="soundIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M11 5L6 9H2v6h4l5 4V5z"/>
      <path id="soundWaves" d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
    </svg>
  </button>
  <div id="toast" class="toast"></div>
  <div id="app" class="relative z-10 min-h-screen"></div>

  <script>
    // ========== WEB AUDIO API SOUND SYSTEM ==========
    let audioCtx = null;
    let isMuted = localStorage.getItem('butchometer_muted') === 'true';

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }

    function updateMuteIcon() {
      const waves = document.getElementById('soundWaves');
      const toggle = document.getElementById('muteToggle');
      if (isMuted) {
        waves.style.display = 'none';
        toggle.classList.add('muted');
      } else {
        waves.style.display = '';
        toggle.classList.remove('muted');
      }
    }

    function toggleMute() {
      isMuted = !isMuted;
      localStorage.setItem('butchometer_muted', isMuted);
      updateMuteIcon();
      if (!isMuted) {
        initAudio();
        playSound('click');
      }
    }

    // Synthesized SFX
    function playSound(type) {
      if (isMuted || !audioCtx) return;
      
      try {
        const now = audioCtx.currentTime;
        
        switch(type) {
          case 'click':
          case 'thunk': {
            // Heavy thunk - low frequency punch
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(80, now);
            osc.frequency.exponentialRampToValueAtTime(40, now + 0.1);
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(200, now);
            
            gain.gain.setValueAtTime(0.4, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start(now);
            osc.stop(now + 0.15);
            break;
          }
          
          case 'safe': {
            // Soft thud
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(100, now);
            osc.frequency.exponentialRampToValueAtTime(60, now + 0.08);
            
            gain.gain.setValueAtTime(0.25, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start(now);
            osc.stop(now + 0.1);
            break;
          }
          
          case 'mid': {
            // Medium impact
            const osc = audioCtx.createOscillator();
            const noise = createNoise(0.05);
            const gain = audioCtx.createGain();
            const noiseGain = audioCtx.createGain();
            
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.exponentialRampToValueAtTime(80, now + 0.1);
            
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
            
            noiseGain.gain.setValueAtTime(0.1, now);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            noise.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            
            osc.start(now);
            osc.stop(now + 0.15);
            break;
          }
          
          case 'unhinged':
          case 'whip': {
            // Whip crack + punch
            const noise = createNoise(0.15);
            const osc = audioCtx.createOscillator();
            const filter = audioCtx.createBiquadFilter();
            const gain = audioCtx.createGain();
            const oscGain = audioCtx.createGain();
            
            filter.type = 'highpass';
            filter.frequency.setValueAtTime(2000, now);
            filter.frequency.exponentialRampToValueAtTime(500, now + 0.1);
            
            gain.gain.setValueAtTime(0.4, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);
            
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(200, now);
            osc.frequency.exponentialRampToValueAtTime(50, now + 0.15);
            
            oscGain.gain.setValueAtTime(0.3, now);
            oscGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            osc.connect(oscGain);
            oscGain.connect(audioCtx.destination);
            
            osc.start(now);
            osc.stop(now + 0.2);
            break;
          }
          
          case 'whoosh': {
            // Forge whoosh
            const noise = createNoise(0.3);
            const filter = audioCtx.createBiquadFilter();
            const gain = audioCtx.createGain();
            
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(500, now);
            filter.frequency.exponentialRampToValueAtTime(2000, now + 0.15);
            filter.frequency.exponentialRampToValueAtTime(300, now + 0.4);
            filter.Q.setValueAtTime(2, now);
            
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.2, now + 0.05);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
            
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            break;
          }
          
          case 'impact': {
            // Heavy hammer hit
            const osc = audioCtx.createOscillator();
            const osc2 = audioCtx.createOscillator();
            const noise = createNoise(0.2);
            const gain = audioCtx.createGain();
            const noiseGain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(100, now);
            osc.frequency.exponentialRampToValueAtTime(30, now + 0.3);
            
            osc2.type = 'triangle';
            osc2.frequency.setValueAtTime(60, now);
            osc2.frequency.exponentialRampToValueAtTime(20, now + 0.4);
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(400, now);
            
            gain.gain.setValueAtTime(0.5, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
            
            noiseGain.gain.setValueAtTime(0.15, now);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            
            osc.connect(gain);
            osc2.connect(gain);
            gain.connect(audioCtx.destination);
            noise.connect(filter);
            filter.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            
            osc.start(now);
            osc2.start(now);
            osc.stop(now + 0.5);
            osc2.stop(now + 0.5);
            break;
          }
          
          case 'lock':
          case 'tick': {
            // Metallic tick/lock
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'square';
            osc.frequency.setValueAtTime(1200, now);
            osc.frequency.exponentialRampToValueAtTime(800, now + 0.05);
            
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start(now);
            osc.stop(now + 0.08);
            break;
          }
        }
      } catch(e) {
        console.warn('Audio error:', e);
      }
    }

    function createNoise(duration) {
      const bufferSize = audioCtx.sampleRate * duration;
      const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const output = buffer.getChannelData(0);
      
      for (let i = 0; i < bufferSize; i++) {
        output[i] = Math.random() * 2 - 1;
      }
      
      const noise = audioCtx.createBufferSource();
      noise.buffer = buffer;
      noise.start();
      return noise;
    }

    // ========== EMBER PARTICLES ==========
    function createEmbers() {
      const container = document.getElementById('embers');
      if (!container) return;
      
      // Check for reduced motion preference
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      
      for (let i = 0; i < 12; i++) {
        const ember = document.createElement('div');
        ember.className = 'ember';
        ember.style.left = Math.random() * 100 + '%';
        ember.style.setProperty('--drift', (Math.random() - 0.5) * 80 + 'px');
        ember.style.animationDelay = Math.random() * 8 + 's';
        ember.style.animationDuration = (6 + Math.random() * 4) + 's';
        container.appendChild(ember);
      }
    }

    // ========== LAVA SPLASH EFFECT ==========
    function createLavaSplash(x, y) {
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      
      const splash = document.createElement('div');
      splash.className = 'lava-splash';
      splash.style.left = x + 'px';
      splash.style.top = y + 'px';
      
      for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        particle.className = 'lava-particle';
        const angle = (Math.PI * 2 / 8) * i + (Math.random() - 0.5) * 0.5;
        const distance = 30 + Math.random() * 40;
        particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
        particle.style.setProperty('--ty', Math.sin(angle) * distance - 20 + 'px');
        particle.style.width = (4 + Math.random() * 6) + 'px';
        particle.style.height = particle.style.width;
        splash.appendChild(particle);
      }
      
      document.body.appendChild(splash);
      setTimeout(() => splash.remove(), 700);
    }

    // ========== TOAST ==========
    function showToast(message, duration = 2500) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), duration);
    }

    // ========== SHARE FEATURE ==========
    async function shareScore(score, resultLine) {
      const url = 'https://infinitlyal-dev.github.io/Butchometer/';
      const text = `I scored ${score} on BUTCHOMETER. Ten questions. No mercy. Your turn:`;
      const fullText = `${text} ${url}`;
      
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'BUTCHOMETER',
            text: text,
            url: url
          });
          playSound('tick');
        } catch(e) {
          if (e.name !== 'AbortError') {
            copyToClipboard(fullText);
          }
        }
      } else {
        copyToClipboard(fullText);
      }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showToast('Copied to clipboard. Now go find a victim.');
        playSound('tick');
      }).catch(() => {
        showToast('Share this: ' + text);
      });
    }

    // ========== QUESTIONS BY CATEGORY ==========
    const questionsByCategory = {
      homeLife: [
        { id: 'HL01', setup: "It's 6:47 AM. You're standing in the kitchen in your underwear, staring at an empty coffee bag. There's instant in the back of the cupboard. It's been there since the previous tenant.", answers: [
          { text: "You chew the crystals raw, washed down with sink water—ancestors forged empires without fancy brews, and so will you.", points: 3 },
          { text: "You make the instant because caffeine is a chemical and chemicals don't care about your feelings. It tastes like regret but regret is still technically a flavor.", points: 2 },
          { text: "You drive to the nearest café in your pajama pants because you have standards and those standards include not drinking something that dissolves.", points: 1 }
        ]},
        { id: 'HL02', setup: "There's a spider on the wall. Medium-sized. It hasn't moved in three minutes. You've been watching it like it owes you an explanation for being there.", answers: [
          { text: "You get a glass and a postcard, trap it with the care of a bomb disposal unit, and release it outside while whispering an apology because all life has value, even life with eight legs.", points: 1 },
          { text: "You ignore it entirely—that spider's now your tenant, earning its keep by catching flies, no rent required.", points: 3 },
          { text: "You smack it with whatever's nearby because you didn't invite it, it didn't pay to be here, and cohabitation requires consent.", points: 2 }
        ]},
        { id: 'HL03', setup: "Someone touched the thermostat. The house is now 74 degrees. You can feel your electricity bill climbing in real time. Sweat is forming. This is not a temperature—it's a betrayal.", answers: [
          { text: "You rip off the cover and stash it away—comfort's earned through grit, not knobs; blankets exist for the weak.", points: 3 },
          { text: "You call a household meeting to establish clear thermostat boundaries because adults communicate, and communication prevents the kind of resentment that ends leases.", points: 1 },
          { text: "You change it back without comment. If they change it again, you change it again. This is a war of attrition, not a conversation.", points: 2 }
        ]},
        { id: 'HL04', setup: "Your phone battery is at 4%. You're not near a charger. You have one text to send, two emails to check, and a growing sense that this is somehow a personal failing.", answers: [
          { text: "You send the text, accept the email will wait, and let the phone die with dignity. People survived for millennia without constant communication. You can too.", points: 2 },
          { text: "You kill the battery on purpose—if it's vital, they'll track you down; leashes like phones deserve to go dark.", points: 3 },
          { text: "You ration every second. Low power mode. Screen brightness zero. You compose the text mentally before typing because efficiency is survival now.", points: 1 }
        ]},
        { id: 'HL05', setup: "You're cooking. The smoke alarm goes off. Nothing is burning. The alarm just has opinions about your technique and volume is how it expresses them.", answers: [
          { text: "You fan it with a towel until it stops, muttering that this happens every time, and continue cooking because you're not going to let a ceiling beep dictate dinner.", points: 2 },
          { text: "You yank the battery out—the alarm's fired; real men smell smoke before gadgets whine.", points: 3 },
          { text: "You open every window, turn on every fan, and consider this a learning experience about ventilation and the sensitive feelings of safety equipment.", points: 1 }
        ]},
        { id: 'HL06', setup: "The WiFi is down. You've restarted the router twice. Nothing. You're standing there, watching blinking lights like they contain meaning. They don't.", answers: [
          { text: "You step outside—WiFi's a chain; break it, and rediscover silence, books, and self-reliance.", points: 3 },
          { text: "You unplug everything, wait thirty seconds like some ancient ritual, plug it back in, and accept that technology is mostly just waiting for things to decide to work.", points: 2 },
          { text: "You call the provider, navigate the automated system, wait on hold for twenty minutes, and speak to a human who asks if you've tried restarting it. You have. You say yes.", points: 1 }
        ]},
        { id: 'HL07', setup: "Your neighbor is playing music. Loudly. It's 10 PM on a Tuesday. Not late enough to be illegal. Just late enough to be annoying. The bass is in your walls now.", answers: [
          { text: "You put on headphones, listen to something calming, and remind yourself that conflict is expensive and you have to live next to this person for the foreseeable future.", points: 1 },
          { text: "You crank your own tunes louder, superior in every way—this ain't talk, it's volume warfare, and you fight to win.", points: 3 },
          { text: "You knock on their door, introduce yourself if you haven't, and mention it politely because most people don't realize how sound carries.", points: 2 }
        ]},
        { id: 'HL08', setup: "Your glasses are dirty. Very dirty. You've been seeing the world through a fog you created yourself. There's no cloth nearby. Just your shirt, which is also not clean.", answers: [
          { text: "You breathe on them and wipe with your shirt because this is what shirts are for now. Function over fashion. You can see. Mostly. Good enough.", points: 2 },
          { text: "You wait until you can clean them properly because smearing is worse than fog and you're not going to make this problem bigger just because you're impatient.", points: 1 },
          { text: "You ditch them altogether—the world's better blurred; sharp vision's for those afraid of mystery.", points: 3 }
        ]},
        { id: 'HL09', setup: "There's a fly in your house. One fly. It's been three days. Every time you think it's gone, it returns. It has landed on your food twice. It's winning.", answers: [
          { text: "You grant it residency—one fly's no army; it stays till it leaves, teaching patience like a silent master.", points: 3 },
          { text: "You open windows strategically and wait because flies have the attention span of flies and eventually it will forget where it is and leave.", points: 1 },
          { text: "You become a hunter. You wait. You track. You strike with a rolled magazine and miss four times but on the fifth, victory.", points: 2 }
        ]},
        { id: 'HL10', setup: "You've walked into a room and forgotten why. You're standing there. The room is waiting. You could retrace your steps. You could also just accept the void.", answers: [
          { text: "You grab whatever's closest—that's your purpose now; brains falter, hands decide.", points: 3 },
          { text: "You walk back to where you started because context helps memory and you're not going to stand in a doorway like a confused sim waiting for instructions.", points: 1 },
          { text: "You stand still and wait for it to come back. Trust the brain. It knows things. It's just processing. Give it a moment.", points: 2 }
        ]},
        { id: 'HL11', setup: "The fitted sheet came off the corner. Again. It's 2 AM. You're lying there, on a mattress that now has a wrinkled fabric tumor. You could fix it. You could also just live like this.", answers: [
          { text: "You sleep on the bare mattress—sheets are luxuries; true rest needs only a surface and resolve.", points: 3 },
          { text: "You get up, remake the bed properly, tuck the corners tight, because sleep quality matters.", points: 1 },
          { text: "You shove it back, roughly, without fully remaking anything, and lie down before it can escape again. Good enough is a sleep strategy.", points: 2 }
        ]},
        { id: 'HL12', setup: "The power adapter doesn't quite fit. It fits, but not comfortably. You have to hold it at an angle. If you let go, nothing charges. This is your life now.", answers: [
          { text: "You jam it in, prop something against it, and hope friction and gravity do the rest. This is engineering. MacGyver would understand.", points: 2 },
          { text: "You get a new adapter or cable because this is a solvable problem and you're not going to spend your days propping electronics like they're on life support.", points: 1 },
          { text: "You hold it steady for hours—adapters bend to will, not the other way around.", points: 3 }
        ]},
        { id: 'HL13', setup: "You're watching something alone. A plot twist happens. It's huge. You have no one to talk to about it. The cat doesn't care. The walls are unhelpful.", answers: [
          { text: "You text someone who's seen it, carefully avoiding spoilers for anyone who hasn't, because shared joy is real joy.", points: 1 },
          { text: "You explain it to the cat in full—felines understand twists; walls echo wisdom.", points: 3 },
          { text: "You sit with it. Process. This moment is yours. Not everything needs external validation.", points: 2 }
        ]},
        { id: 'HL14', setup: "You stepped in something wet. With socks on. In your own home. It could be anything. You don't want to look. You're standing still, one foot contaminated, the other pure.", answers: [
          { text: "You march on without glancing—wet's temporary; resolve's eternal.", points: 3 },
          { text: "You investigate, clean it up, put on new socks, and sanitize because pretending it didn't happen doesn't make your floor any less wet.", points: 1 },
          { text: "You remove the sock, toss it toward laundry, and walk on heel only until you forget this happened.", points: 2 }
        ]},
        { id: 'HL15', setup: "You tried to catch something that was falling. You missed. It hit the ground. You're standing there, hands out, looking at the object that ignored your reflexes entirely.", answers: [
          { text: "You kick it. Lightly. As punishment. The object made you look bad. This is consequences.", points: 2 },
          { text: "You leave it fallen—it chose gravity; some things belong on the ground.", points: 3 },
          { text: "You pick it up, check for damage, and accept that not every save is possible. Physics doesn't care about your intentions.", points: 1 }
        ]},
        { id: 'HL16', setup: "Your earbuds are tangled. Significantly tangled. You put them in your pocket for five minutes and they've formed a knot that would impress a sailor.", answers: [
          { text: "You patiently untangle them, following each cord, because knots have solutions and rushing only makes them tighter.", points: 1 },
          { text: "You wear the knot like a badge—sound works fine; perfection's for the feeble.", points: 3 },
          { text: "You pull at it until something gives because tangles aren't that serious and if something breaks, that's an excuse to buy wireless ones finally.", points: 2 }
        ]},
        { id: 'HL17', setup: "You've had a toothache for five days. Someone suggests a dentist. Dentists are people who went to school specifically to disappoint you while you can't close your mouth.", answers: [
          { text: "You endure it—teeth are bones, bones mend; spares exist if this one fails.", points: 3 },
          { text: "You try clove oil, ibuprofen, and hoping because sometimes teeth just need to work through their feelings. Give it a few more days.", points: 2 },
          { text: "You make the appointment because tooth infections can spread to your brain and dying of stubbornness is a legacy nobody wants.", points: 1 }
        ]},
        { id: 'HL18', setup: "It's 3 AM. There's a sound downstairs. Not a normal sound. You don't own a pet. You don't own anything that makes that particular noise.", answers: [
          { text: "You stay in the room, lock the door, and call someone because this is how people survive horror movies.", points: 1 },
          { text: "You descend in the dark—whatever lurks picked the wrong domain; you answer intrusions with force.", points: 3 },
          { text: "You grab something heavy, turn on lights as you go, and investigate like someone who owns this house. It's probably the wind.", points: 2 }
        ]}
      ],
      workResponsibility: [
        { id: 'WR01', setup: "Your alarm didn't go off. You're awake now. You're also late. Very late. The kind of late where getting ready becomes a negotiation between hygiene and punctuality.", answers: [
          { text: "You bolt out as is—appearance bows to presence; real work doesn't wait for grooming.", points: 3 },
          { text: "You do everything anyway—shower, skincare, actual breakfast—because showing up put-together matters more than showing up on time.", points: 1 },
          { text: "You prioritize strategically. Deodorant: yes. Hair situation: manageable. Coffee: travel mug. You're late but you're not unhinged.", points: 2 }
        ]},
        { id: 'WR02', setup: "Someone at work brought donuts. There's one left. It's been there for hours. Multiple people have looked at it. Nobody has taken it. The donut is now a moral dilemma.", answers: [
          { text: "You claim it whole—hesitation lost it for them; hunger demands action.", points: 3 },
          { text: "You cut it in half and take half because compromise is civilization.", points: 2 },
          { text: "You leave it because someone else might want it more, and being the person who took the last donut is a reputation you're not willing to carry.", points: 1 }
        ]},
        { id: 'WR03', setup: "The printer is jammed. Again. You opened it. You see paper. You pulled it. Something tore. Now there's more paper and less clarity about whether you've made things better or much worse.", answers: [
          { text: "You close it, restart it, and follow the instructions on the display because printers are sensitive creatures and brute force only creates more problems.", points: 1 },
          { text: "You abandon it—if it prints, fine; if not, words weren't meant to be.", points: 3 },
          { text: "You pull harder. There's paper in there and it doesn't belong. You'll get it out. Tools if necessary.", points: 2 }
        ]},
        { id: 'WR04', setup: "You sent an email. It had a typo. A visible, obvious typo. You noticed it after you hit send. The email is now out there, imperfect, forever.", answers: [
          { text: "You fire off another with a bolder error—now it's a signature style, not a slip.", points: 3 },
          { text: "You ignore it. Everyone makes typos. If they can't figure out what you meant from context, that's their problem.", points: 2 },
          { text: "You send a quick follow-up correcting the typo because clarity matters and you'd rather own the mistake.", points: 1 }
        ]},
        { id: 'WR05', setup: "Someone asks what you do for work at a party. It's the question that determines how much of the conversation you'll enjoy.", answers: [
          { text: "You invent a title—tonight, you're a whiskey taster or woodworker; facts are for resumes.", points: 3 },
          { text: "You answer honestly and try to make it interesting because your job is part of your life and most people are just making conversation.", points: 1 },
          { text: "You give the short version and redirect by asking what they do, because deflecting with genuine interest is social judo.", points: 2 }
        ]},
        { id: 'WR06', setup: "You're in a job interview. They ask where you see yourself in five years. You don't know where you see yourself next week. The answer matters. Your brain is empty.", answers: [
          { text: "You declare 'mastering this role or forging my own path'—futures aren't predicted, they're carved.", points: 3 },
          { text: "You give a thoughtful, generic answer about growth, learning, and contributing to the team because interviews are performances.", points: 1 },
          { text: "You answer honestly, somewhat, mentioning that you're focused on the present while staying open to opportunity.", points: 2 }
        ]},
        { id: 'WR07', setup: "Someone took credit for your idea in a meeting. In front of everyone. They didn't even pause. Just restated your point like they invented thinking.", answers: [
          { text: "You let it go for now and plan to address it privately later because public conflict rarely ends well.", points: 1 },
          { text: "You cut in sharp: 'That's my line, well echoed'—ideas have owners, claim yours without apology.", points: 3 },
          { text: "You say 'glad you agree with what I mentioned earlier' loud enough for the room to hear.", points: 2 }
        ]},
        { id: 'WR08', setup: "You're at a work event. Someone who outranks you is very drunk. They're telling you things. Personal things. Things that change how you'll see them on Monday.", answers: [
          { text: "You file it away—not for leverage, for truth; knowledge is a tool, wield it wisely.", points: 3 },
          { text: "You listen, nod, and forget everything tomorrow because discretion is valuable.", points: 1 },
          { text: "You steer them toward water, a seat, and a safer topic because this isn't good for either of you.", points: 2 }
        ]},
        { id: 'WR09', setup: "Your meeting starts in thirty seconds. Your camera is off. You are dressed for comfort, not leadership.", answers: [
          { text: "You turn the camera on, sit up straight, and commit to looking employed.", points: 1 },
          { text: "You leave it off and participate verbally. Presence is a mindset.", points: 2 },
          { text: "You stay muted and let the meeting happen around you.", points: 3 }
        ]},
        { id: 'WR10', setup: "Someone messages: 'Hey, quick call?' There is no context. There is never context.", answers: [
          { text: "You ask what it's about before agreeing.", points: 1 },
          { text: "You don't respond until the problem solves itself.", points: 3 },
          { text: "You say yes and prepare for whatever this becomes.", points: 2 }
        ]},
        { id: 'WR11', setup: "You are fifteen minutes into a meeting that has produced nothing new.", answers: [
          { text: "You mentally clock out and observe the process like a sociologist.", points: 3 },
          { text: "You stay engaged and take notes anyway.", points: 1 },
          { text: "You multitask quietly and wait it out.", points: 2 }
        ]},
        { id: 'WR12', setup: "You double-booked yourself. Both meetings think they're important.", answers: [
          { text: "You apologize and reschedule one properly.", points: 1 },
          { text: "You choose one and let the other survive without you.", points: 3 },
          { text: "You split time and do your best.", points: 2 }
        ]}
      ],
      socialPressure: [
        { id: 'SP01', setup: "The pen you picked up doesn't work. You're mid-signature. The moment is now. You click it again. Nothing. Once more. A dry scratch.", answers: [
          { text: "You etch with force—ink's optional; commitment carves its own path.", points: 3 },
          { text: "You calmly ask for another pen because these things happen.", points: 1 },
          { text: "You scribble aggressively on the corner of the paper until it works because pens respond to pressure.", points: 2 }
        ]},
        { id: 'SP02', setup: "Someone waved at you. You waved back. They were waving at someone behind you. You're standing there, arm still slightly raised, dignity falling like slow-motion confetti.", answers: [
          { text: "You pretend you were stretching. You commit to the stretch. Full arm extension. Maybe a yawn.", points: 1 },
          { text: "You wave harder, at nothing—starts are finishes; quitters don't wave.", points: 3 },
          { text: "You own it. A brief laugh, a shrug, and you move on because this happens to everyone.", points: 2 }
        ]},
        { id: 'SP03', setup: "You've forgotten someone's name. You've met them three times. They clearly remember yours. They're walking toward you right now.", answers: [
          { text: "You dub them 'chief' or 'legend'—names are chains; nicknames forge bonds.", points: 3 },
          { text: "You greet them warmly without using their name and hope the conversation goes nowhere that requires it.", points: 1 },
          { text: "You confess immediately. 'I'm so sorry, I've forgotten your name.' It's awkward but honest.", points: 2 }
        ]},
        { id: 'SP04', setup: "You just realized you've been pronouncing a word wrong. For years. Possibly decades. In front of people. Confidently. Someone just corrected you.", answers: [
          { text: "You thank them, genuinely, because learning is a gift and you're not too proud to accept it.", points: 1 },
          { text: "You stick to your version—words bend to speakers; tradition starts with one man.", points: 3 },
          { text: "You nod, file it away, and vow to never say that word out loud again.", points: 2 }
        ]},
        { id: 'SP05', setup: "You're at a party. You don't know many people. Someone is talking to you, but you can't hear them over the music. You've already said 'what?' twice.", answers: [
          { text: "You bail to the bar—drinks speak clearer than shouts; escape's an art.", points: 3 },
          { text: "You nod, smile, and hope your face is doing something appropriate.", points: 1 },
          { text: "You lean in close, cup your ear, and commit to understanding because connection matters.", points: 2 }
        ]},
        { id: 'SP06', setup: "You've just sent a text to the wrong person. The text was about them. The text was not flattering. You're watching the 'delivered' notification like it's a slow-motion car crash.", answers: [
          { text: "You send an immediate apology, explain the mistake, and hope they understand that phones are chaos.", points: 1 },
          { text: "You amplify it with another zinger—truth hurts, but owning it commands respect.", points: 3 },
          { text: "You follow it up with 'sorry, wrong person' and nothing else because elaboration makes it worse.", points: 2 }
        ]},
        { id: 'SP07', setup: "Someone offers a handshake and squeezes. Hard. Harder than a greeting requires. They're looking into your eyes like they're trying to read your tax returns.", answers: [
          { text: "You lock in, unyielding—this ain't release till they yield; handshakes test mettle.", points: 3 },
          { text: "You match their pressure briefly and release because you're confident enough not to turn every hello into a referendum on worth.", points: 1 },
          { text: "You squeeze back proportionally—firm but not aggressive—because you're not a pushover but you're also not going to injure someone over a greeting.", points: 2 }
        ]},
        { id: 'SP08', setup: "Someone is explaining something you already know. In detail. With enthusiasm. They're not close to finishing. Your face is doing a lot of work right now.", answers: [
          { text: "You listen politely because their intent matters more than the content.", points: 1 },
          { text: "You cut them off: 'I know'—light dies, but truth shines; attention's earned.", points: 3 },
          { text: "You nod strategically, say 'right, right' at intervals, and guide them toward the end.", points: 2 }
        ]},
        { id: 'SP09', setup: "Someone tells you that you look tired. You're not tired. You're just existing with the face you were given. This is how you look. Apparently that look is 'tired.'", answers: [
          { text: "You fire back 'You too'—statements rebound; let them taste their words.", points: 3 },
          { text: "You say 'thanks, I'm fine' and move on because explaining takes more energy than accepting.", points: 1 },
          { text: "You say 'I'm not tired, this is just my face' with a smile that's equally informative and slightly defensive.", points: 2 }
        ]},
        { id: 'SP10', setup: "You're playing a party game. Someone challenges you directly. Everyone is watching. It's not serious but it's also not not serious.", answers: [
          { text: "You crush them utterly—games demand victors; mercy's for losers.", points: 3 },
          { text: "You play to have fun, not to win, because the moment you care too much about a party game is the moment you've lost something more important.", points: 1 },
          { text: "You play well. Strategically. You want to win but you keep it light. Competitive but charming.", points: 2 }
        ]},
        { id: 'SP11', setup: "A stranger compliments you. Something specific. Your jacket, your energy, your presence. You weren't expecting it.", answers: [
          { text: "You say 'thank you, that's kind' because accepting compliments gracefully is a skill.", points: 1 },
          { text: "You affirm 'I know'—truth acknowledged; confidence echoes.", points: 3 },
          { text: "You deflect with a compliment back. Classic redirect. Nobody has to sit in the discomfort of receiving alone.", points: 2 }
        ]},
        { id: 'SP12', setup: "Someone at a party confidently states something you know is completely, provably, almost impressively wrong.", answers: [
          { text: "You let it go because correcting strangers at parties is exhausting and being right isn't always the same as being useful.", points: 1 },
          { text: "You dismantle it publicly, facts armed—truth bows to no crowd.", points: 3 },
          { text: "You offer a gentle 'actually' and present the correct information with a tone that suggests you're helping.", points: 2 }
        ]}
      ],
      foodConsumption: [
        { id: 'FC01', setup: "There's a container in the back of the fridge. You don't remember putting it there. The lid is bulging with ambition.", answers: [
          { text: "You devour it blind—dates are suggestions; guts conquer unknowns.", points: 3 },
          { text: "You throw it away unopened, container and all.", points: 1 },
          { text: "You crack it open and give it a sniff because noses exist for exactly this reason.", points: 2 }
        ]},
        { id: 'FC02', setup: "The jar won't open. You've tried twice. Your grip keeps slipping. Someone is watching from across the room. Your entire identity now depends on pickles.", answers: [
          { text: "You run hot water over the lid because metal expands when heated and physics doesn't care about pride.", points: 1 },
          { text: "You shatter it into a bowl—jars yield to will; contents claimed.", points: 3 },
          { text: "You wrap it in a towel, use your whole body, and give it one genuine effort.", points: 2 }
        ]},
        { id: 'FC03', setup: "Someone orders food 'extra spicy' and slides it toward you with a smile. This isn't generosity. This is a trap.", answers: [
          { text: "You finish it unflinching, demand more—heat tempers; weakness flees.", points: 3 },
          { text: "You decline because you know your limits and performing pain for entertainment isn't dignified.", points: 1 },
          { text: "You take a bite, handle what you can, drink water if needed, and maintain composure.", points: 2 }
        ]},
        { id: 'FC04', setup: "Someone hands you meat from an animal you cannot identify. They're proud. They caught it. It's charred, on a stick, and has a face.", answers: [
          { text: "You decline politely because mystery meat is how documentaries about food poisoning begin.", points: 1 },
          { text: "You bite unquestioned—protein's protein; labels weaken the hunt.", points: 3 },
          { text: "You ask what it is, get an answer that raises more questions, eat it anyway because refusing hospitality is rude.", points: 2 }
        ]}
      ],
      outdoorsAnimals: [
        { id: 'OA01', setup: "It's raining. Steady, not heavy. Your car is forty feet away. No umbrella. Your jacket hood is decorative at best.", answers: [
          { text: "You wait at the door and watch the radar because getting wet is step one of getting sick.", points: 1 },
          { text: "You stride normal—rain's mere water; fear it not.", points: 3 },
          { text: "You pull the hood up, accept it won't help, and jog to the car.", points: 2 }
        ]},
        { id: 'OA02', setup: "You're in the woods. There's a bear. Not close, but close enough to have an opinion about you.", answers: [
          { text: "You back away slowly, make yourself small, and avoid eye contact.", points: 1 },
          { text: "You advance staring—one apex rules; claim the woods.", points: 3 },
          { text: "You make yourself big, make noise, and convince the bear you're more trouble than you're worth.", points: 2 }
        ]},
        { id: 'OA03', setup: "There's a cliff. There's water below. Everyone else jumped and survived. Probably. They're down there waving at you.", answers: [
          { text: "You climb back down the safe path because peer pressure is just pressure that happens to have friends.", points: 1 },
          { text: "You flip back—body saves flair; destiny calls bold.", points: 3 },
          { text: "You check the depth, take a breath, and jump feet-first because controlled risk is how you grow.", points: 2 }
        ]},
        { id: 'OA04', setup: "You're swimming. Something touches your leg. You don't know what it is. You didn't see it.", answers: [
          { text: "You swim calmly toward shore because panic attracts predators.", points: 1 },
          { text: "You grasp back—contact mutual; depths respect reach.", points: 3 },
          { text: "You keep swimming but faster. Not panicked. Purposeful.", points: 2 }
        ]}
      ],
      travelPublic: [
        { id: 'TP01', setup: "The parking spot is small. Very small. The kind of small that makes you wonder if the person who painted it has ever seen a car.", answers: [
          { text: "You span two—lots deserve no respect; rules bend to resolve.", points: 3 },
          { text: "You find another spot. A better spot. A spot that doesn't require you to perform geometry in public.", points: 1 },
          { text: "You try it. Multiple angles. Multiple attempts. Some back and forth. You succeed.", points: 2 }
        ]},
        { id: 'TP02', setup: "Someone is standing too close to you in line. Not touching you. Just... there. In your space. Breathing your air.", answers: [
          { text: "You say nothing, suffer in silence, and remind yourself that everyone has different cultural norms.", points: 1 },
          { text: "You turn, stare silent—they retreat; presence conquers.", points: 3 },
          { text: "You take a step forward. They take a step forward. You take another step. This is a slow-motion chase now.", points: 2 }
        ]},
        { id: 'TP03', setup: "You're lost. The GPS keeps saying 'recalculating' in a tone that suggests disappointment.", answers: [
          { text: "You pull over and ask a local because humans have navigated each other home for thousands of years.", points: 1 },
          { text: "You kill the GPS—confusion's yours, not tech's; forge ahead.", points: 3 },
          { text: "You keep driving with confidence because all roads lead somewhere.", points: 2 }
        ]},
        { id: 'TP04', setup: "The plane is turbulent. Really turbulent. The kind where even the flight attendants sit down.", answers: [
          { text: "You breathe slowly, remind yourself that turbulence is normal.", points: 1 },
          { text: "You loosen, eyes shut—fate calls; meet it relaxed.", points: 3 },
          { text: "You look out the window. Not because it helps, but because watching it is somehow better than imagining it.", points: 2 }
        ]}
      ]
    };

    // ========== RESULT LINES ==========
    const resultLines = {
      low: [
        "You brought a backup phone charger to a barbecue.",
        "Your safe word is 'actually, let's just talk about it.'",
        "Somewhere, a weighted blanket is waiting for you to come home.",
        "A firm handshake would require emotional preparation.",
        "Your comfort zone has a couch and a cancellation policy.",
        "You read the terms and conditions. All of them.",
        "Your fight-or-flight response is 'send a follow-up email.'",
        "You would describe yourself as 'indoorsy.'",
        "Your texts have drafts. Multiple drafts.",
        "You've canceled plans because of weather that turned out to be fine.",
        "You own comfortable shoes. That's it. That's the observation."
      ],
      mid: [
        "Competent but not memorable. Like beige, but load-bearing.",
        "You'd survive a camping trip. Probably. With complaints.",
        "Tough when it's convenient. Soft when it costs nothing.",
        "You own a toolbox. You've opened it twice.",
        "Not soft. Not hard. The human equivalent of a firm mattress.",
        "You handle problems. Eventually. With supervision.",
        "Functional. Dependable. Utterly unremarkable.",
        "Your risk tolerance is 'mild salsa.'",
        "You're the friend people call second. And that's fine.",
        "You have a 'go bag.' It's a tote bag with snacks.",
        "Decisive when it doesn't matter. Paralyzed when it does."
      ],
      high: [
        "You've fixed something by hitting it. It worked.",
        "Your handshake has ended conversations.",
        "Pain is just your body making suggestions you're free to ignore.",
        "Instructions are just opinions from people who weren't there.",
        "Your backup plan is 'do the first plan harder.'",
        "Doctors are just people with opinions. Noted.",
        "Expiration dates are corporations showing fear.",
        "You've called something 'fine' while it was visibly on fire.",
        "Weather reports are suggestions you've never taken personally.",
        "You've answered 'does this hurt?' with 'define hurt.'",
        "GPS is just someone's opinion about how you should drive.",
        "You've won an argument by just waiting. They got tired. You didn't."
      ]
    };

    // ========== GAME STATE ==========
    let state = {
      screen: 'home',
      mode: null,
      players: [],
      playerNames: [''],
      currentPlayerIndex: 0,
      currentQuestionIndex: 0,
      sessionQuestions: [],
      measuring: false,
      showResult: false
    };

    // ========== LOCAL STORAGE ==========
    const STORAGE_KEY = 'butchometer_recent';
    const STORAGE_PLAYS = 'butchometer_plays';
    const STORAGE_RESULTS = 'butchometer_results';
    
    function getRecent() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
      catch { return []; }
    }
    function getRecentResults() {
      try { return JSON.parse(localStorage.getItem(STORAGE_RESULTS) || '[]'); }
      catch { return []; }
    }
    function saveRecent(ids) {
      const recent = getRecent();
      const updated = [...new Set([...ids, ...recent])].slice(0, 50);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));
    }
    function saveRecentResult(line) {
      const recent = getRecentResults();
      const updated = [...new Set([line, ...recent])].slice(0, 20);
      localStorage.setItem(STORAGE_RESULTS, JSON.stringify(updated));
    }
    function incrementPlays() {
      const plays = parseInt(localStorage.getItem(STORAGE_PLAYS) || '0');
      localStorage.setItem(STORAGE_PLAYS, String(plays + 1));
      if ((plays + 1) % 8 === 0) {
        localStorage.setItem(STORAGE_KEY, '[]');
        localStorage.setItem(STORAGE_RESULTS, '[]');
      }
    }

    // ========== QUESTION SELECTION ==========
    function pickQuestions() {
      const recent = getRecent();
      const shuffle = arr => [...arr].sort(() => Math.random() - 0.5);
      const filter = arr => arr.filter(q => !recent.includes(q.id));
      
      const categories = {
        homeLife: questionsByCategory.homeLife,
        workResponsibility: questionsByCategory.workResponsibility,
        socialPressure: questionsByCategory.socialPressure,
        foodConsumption: questionsByCategory.foodConsumption,
        outdoorsAnimals: questionsByCategory.outdoorsAnimals,
        travelPublic: questionsByCategory.travelPublic
      };
      
      const selected = [];
      const categoryUsage = {};
      let lastCategory = null;
      
      Object.keys(categories).forEach(cat => categoryUsage[cat] = 0);
      
      // First 2 questions: Home Life
      let homeLifePool = shuffle(filter(categories.homeLife));
      if (homeLifePool.length < 2) homeLifePool = shuffle(categories.homeLife);
      
      selected.push({ ...homeLifePool[0], category: 'homeLife' });
      selected.push({ ...homeLifePool[1], category: 'homeLife' });
      categoryUsage.homeLife = 2;
      lastCategory = 'homeLife';
      
      // Remaining 8 questions
      const otherCategories = Object.keys(categories).filter(c => c !== 'homeLife');
      
      for (let i = 2; i < 10; i++) {
        let availableCats = otherCategories.filter(cat => categoryUsage[cat] < 2);
        
        if (availableCats.length > 1 && lastCategory !== 'homeLife') {
          availableCats = availableCats.filter(cat => cat !== lastCategory);
        }
        
        if (availableCats.length === 0) {
          availableCats = otherCategories.filter(cat => categoryUsage[cat] < 2);
        }
        if (availableCats.length === 0) {
          availableCats = otherCategories;
        }
        
        const chosenCat = availableCats[Math.floor(Math.random() * availableCats.length)];
        
        let pool = shuffle(filter(categories[chosenCat]));
        if (pool.length === 0) pool = shuffle(categories[chosenCat]);
        
        let question = pool.find(q => !selected.some(s => s.id === q.id));
        if (!question) question = pool[0];
        
        selected.push({ ...question, category: chosenCat });
        categoryUsage[chosenCat]++;
        lastCategory = chosenCat;
      }
      
      // Shuffle answers for each question AND assign display labels
      const labels = ['A', 'B', 'C'];
      const finalQuestions = selected.map(q => {
        const shuffledAnswers = shuffle([...q.answers]).map((a, i) => ({
          ...a,
          label: labels[i]
        }));
        return { ...q, answers: shuffledAnswers };
      });
      
      saveRecent(finalQuestions.map(q => q.id));
      return finalQuestions;
    }

    function getResultLine(score) {
      const bracket = score <= 13 ? 'low' : score <= 22 ? 'mid' : 'high';
      const lines = resultLines[bracket];
      const recentResults = getRecentResults();
      
      let available = lines.filter(l => !recentResults.includes(l));
      if (available.length === 0) available = lines;
      
      const selected = available[Math.floor(Math.random() * available.length)];
      saveRecentResult(selected);
      return selected;
    }

    // ========== RENDER ==========
    function render() {
      document.getElementById('app').innerHTML = screens[state.screen]();
    }

    const screens = {
      home: () => `
        <div class="min-h-screen flex flex-col items-center justify-center p-6 screen-enter">
          <div class="text-center max-w-md heat-shimmer">
            <h1 class="forged-title mb-4">BUTCHOMETER</h1>
            <p class="text-xs text-[var(--text-dim)] mb-16 tracking-[0.2em] uppercase">Ten questions. No mercy.</p>
            <div class="flex flex-col gap-4 max-w-xs mx-auto">
              <button onclick="handleClick(event); selectMode('single');" class="btn py-4 px-8 rounded-lg">
                <span class="text-sm tracking-[0.15em] text-[var(--text-primary)] font-medium">SINGLE</span>
              </button>
              <button onclick="handleClick(event); selectMode('multiplayer');" class="btn py-4 px-8 rounded-lg">
                <span class="text-sm tracking-[0.15em] text-[var(--text-primary)] font-medium">MULTIPLAYER</span>
              </button>
            </div>
          </div>
        </div>`,

      setup: () => `
        <div class="min-h-screen p-6 screen-enter">
          <div class="max-w-md mx-auto pt-8">
            <button onclick="handleClick(event); goHome();" class="text-xs text-[var(--text-dim)] hover:text-[var(--orange)] mb-10 block tracking-wide transition-colors">← BACK</button>
            <h2 class="text-lg mb-6 tracking-[0.1em] text-[var(--orange)] font-semibold uppercase">${state.mode === 'single' ? 'Identify Yourself' : 'Name the Accused'}</h2>
            <div class="card rounded-lg p-6 mb-6">
              ${state.playerNames.map((n, i) => `
                <div class="flex gap-3 mb-3">
                  <input type="text" value="${n}" oninput="updateName(${i}, this.value)" placeholder="Player ${i+1}" class="input flex-1 rounded-lg px-4 py-3 text-sm" maxlength="12">
                  ${state.mode === 'multiplayer' && state.playerNames.length > 2 ? `
                    <button onclick="handleClick(event); removePlayer(${i});" class="text-[var(--text-dim)] hover:text-[var(--orange)] px-3 transition-colors">×</button>
                  ` : ''}
                </div>
              `).join('')}
              ${state.mode === 'multiplayer' && state.playerNames.length < 6 ? `
                <button onclick="handleClick(event); addPlayer();" class="w-full border border-dashed border-[var(--steel-lighter)] text-[var(--text-dim)] py-3 rounded-lg text-xs hover:border-[var(--orange-dim)] hover:text-[var(--orange)] transition-colors mt-2 tracking-wide">
                  + ADD PLAYER
                </button>
              ` : ''}
            </div>
            <button onclick="handleClick(event); startGame();" class="btn btn-primary w-full py-4 rounded-lg">
              <span class="text-sm tracking-[0.15em] text-[var(--text-primary)] font-medium">BEGIN</span>
            </button>
          </div>
        </div>`,

      quiz: () => {
        const q = state.sessionQuestions[state.currentQuestionIndex];
        const p = state.players[state.currentPlayerIndex];
        const progress = ((state.currentQuestionIndex) / 10) * 100;
        const qNum = state.currentQuestionIndex + 1;
        return `
        <div class="min-h-screen p-4 md:p-6 screen-enter">
          <div class="max-w-2xl mx-auto pt-4">
            <div class="flex justify-between items-center mb-4">
              <span class="text-xs text-[var(--text-dim)] tracking-wide">${p?.name || 'PLAYER'}</span>
              <span class="question-number text-[var(--orange)]">QUESTION ${qNum} OF 10</span>
            </div>
            <div class="progress-track h-2 rounded-full mb-8">
              <div class="progress-fill h-full rounded-full" style="width: ${progress}%"></div>
            </div>
            <div class="card rounded-lg p-6 mb-6 heavy-in">
              <p class="text-base md:text-lg leading-relaxed">${q?.setup}</p>
            </div>
            <div class="space-y-3">
              ${q?.answers.map((a, i) => `
                <button onclick="handleAnswerClick(event, ${a.points});" class="answer w-full rounded-lg p-4 text-left slide-in flex items-start" style="animation-delay: ${i * 0.08}s">
                  <span class="answer-label">${a.label}</span>
                  <span class="text-sm md:text-base leading-relaxed text-[var(--text-primary)] flex-1">${a.text}</span>
                </button>`).join('')}
            </div>
          </div>
        </div>`;
      },

      results: () => {
        const p = state.players[state.currentPlayerIndex];
        const score = p?.score || 0;
        return `
        <div class="min-h-screen flex flex-col items-center justify-center p-6 screen-enter">
          <div class="text-center max-w-md">
            <p class="text-xs text-[var(--text-dim)] mb-8 tracking-[0.2em] uppercase">${p?.name}</p>
            <div class="relative w-48 h-48 mx-auto mb-10">
              <div class="gauge w-full h-full rounded-full ${state.measuring ? 'gauge-spin' : ''}"></div>
              ${!state.measuring ? `
                <div class="absolute inset-0 flex items-center justify-center">
                  <span class="text-6xl font-bold score-display score-reveal">${score}</span>
                </div>
              ` : ''}
            </div>
            ${state.showResult ? `
              <div class="heavy-in">
                <p class="text-lg mb-8 leading-relaxed max-w-sm mx-auto">${p?.resultLine}</p>
                <div class="flex flex-col gap-3 max-w-xs mx-auto">
                  ${state.mode === 'multiplayer' && state.currentPlayerIndex < state.players.length - 1 
                    ? `<button onclick="handleClick(event); nextPlayer();" class="btn btn-primary py-4 px-8 rounded-lg text-sm tracking-[0.15em] font-medium">NEXT PLAYER</button>`
                    : state.mode === 'multiplayer' 
                    ? `<button onclick="handleClick(event); showLeaderboard();" class="btn btn-primary py-4 px-8 rounded-lg text-sm tracking-[0.15em] font-medium">FINAL VERDICT</button>`
                    : `
                      <button onclick="handleClick(event); shareScore(${score}, '${p?.resultLine?.replace(/'/g, "\\'")}');" class="btn btn-primary py-4 px-8 rounded-lg share-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16,6 12,2 8,6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
                        <span class="text-sm tracking-[0.1em] font-medium">SHARE SCORE</span>
                      </button>
                      <button onclick="handleClick(event); goHome();" class="btn py-4 px-8 rounded-lg text-sm tracking-[0.15em] font-medium">PLAY AGAIN</button>
                    `}
                </div>
                <p class="text-xs text-[var(--text-muted)] mt-6">Send this to a friend. Let's see how butch they are.</p>
              </div>
            ` : `
              <p class="text-sm text-[var(--text-dim)] tracking-[0.15em]">MEASURING...</p>
            `}
          </div>
        </div>`;
      },

      leaderboard: () => {
        const sorted = [...state.players].sort((a, b) => b.score - a.score);
        return `
        <div class="min-h-screen p-6 screen-enter">
          <div class="max-w-md mx-auto pt-8">
            <h2 class="text-xl mb-8 text-center tracking-[0.15em] text-[var(--orange)] font-semibold">FINAL VERDICT</h2>
            <div class="space-y-3 mb-10">
              ${sorted.map((p, i) => `
                <div class="plaque rounded-lg p-4 flex items-center gap-4 slide-in" style="animation-delay: ${i * 0.1}s">
                  <span class="text-sm text-[var(--text-muted)] w-8 font-semibold">${i + 1}.</span>
                  <div class="flex-1 overflow-hidden">
                    <p class="text-sm text-[var(--text-primary)] tracking-wide font-medium">${p.name}</p>
                    <p class="text-xs text-[var(--text-dim)] truncate mt-1">${p.resultLine}</p>
                  </div>
                  <span class="text-2xl score-display font-bold">${p.score}</span>
                </div>
              `).join('')}
            </div>
            <button onclick="handleClick(event); goHome();" class="btn w-full py-4 rounded-lg text-sm tracking-[0.15em] font-medium">DONE</button>
          </div>
        </div>`;
      }
    };

    // ========== EVENT HANDLERS ==========
    function handleClick(event) {
      initAudio();
      playSound('thunk');
    }

    function handleAnswerClick(event, points) {
      initAudio();
      
      // Determine sound based on points
      const soundType = points === 1 ? 'safe' : points === 2 ? 'mid' : 'unhinged';
      playSound(soundType);
      
      // Create lava splash at click position
      createLavaSplash(event.clientX, event.clientY);
      
      // Process answer
      answer(points);
    }

    // ========== GAME FUNCTIONS ==========
    function selectMode(mode) {
      state.mode = mode;
      state.playerNames = mode === 'multiplayer' ? ['', ''] : [''];
      state.screen = 'setup';
      playSound('whoosh');
      render();
    }

    function goHome() {
      state = { screen: 'home', mode: null, players: [], playerNames: [''], currentPlayerIndex: 0, currentQuestionIndex: 0, sessionQuestions: [], measuring: false, showResult: false };
      render();
    }

    function updateName(i, val) { state.playerNames[i] = val; }
    function addPlayer() { if (state.playerNames.length < 6) { state.playerNames.push(''); render(); } }
    function removePlayer(i) { if (state.playerNames.length > 2) { state.playerNames.splice(i, 1); render(); } }

    function startGame() {
      const names = state.playerNames;
      if (state.mode === 'multiplayer' && names.filter(n => n.trim()).length < 2) return;
      state.players = names.map((n, i) => ({ id: i, name: n.trim() || `Player ${i + 1}`, score: 0, answers: [], resultLine: '' }));
      state.currentPlayerIndex = 0;
      state.currentQuestionIndex = 0;
      state.sessionQuestions = pickQuestions();
      state.screen = 'quiz';
      playSound('whoosh');
      incrementPlays();
      render();
    }

    function answer(points) {
      state.players[state.currentPlayerIndex].score += points;

      if (state.currentQuestionIndex < 9) {
        state.currentQuestionIndex++;
        playSound('tick');
        render();
      } else {
        state.players[state.currentPlayerIndex].resultLine = getResultLine(state.players[state.currentPlayerIndex].score);
        state.measuring = true;
        state.showResult = false;
        state.screen = 'results';
        playSound('whoosh');
        render();
        
        setTimeout(() => {
          state.measuring = false;
          playSound('impact');
          render();
          setTimeout(() => {
            playSound('lock');
            state.showResult = true;
            render();
          }, 400);
        }, 2600);
      }
    }

    function nextPlayer() {
      state.currentPlayerIndex++;
      state.currentQuestionIndex = 0;
      state.sessionQuestions = pickQuestions();
      state.measuring = false;
      state.showResult = false;
      state.screen = 'quiz';
      playSound('whoosh');
      render();
    }

    function showLeaderboard() {
      state.screen = 'leaderboard';
      playSound('impact');
      render();
    }

    // ========== INIT ==========
    updateMuteIcon();
    createEmbers();
    render();
    
    // Initialize audio on first interaction
    document.addEventListener('click', () => initAudio(), { once: true });
    document.addEventListener('touchstart', () => initAudio(), { once: true });
  </script>
</body>
</html>
